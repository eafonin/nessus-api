# =============================================================================
# Base Requirements - Shared by all services
# =============================================================================
# This file contains dependencies used by both mcp-api and scanner-worker.
# Service-specific deps go in requirements-api.txt or requirements-worker.txt.

# =============================================================================
# CRITICAL VERSION PINS - DO NOT UPGRADE WITHOUT TESTING
# =============================================================================
# These specific versions fix "Task group is not initialized" error
#
# Background:
# - anyio >= 4.11.0 + starlette >= 0.50.0 causes task group initialization bugs
# - Affects StreamableHTTPSessionManager in MCP SDK
# - Manifests as RuntimeError during HTTP request handling
#
# Solution:
# - Pin to starlette 0.49.1 (last working version before regression)
# - Pin to anyio 4.6.2.post1 (stable version compatible with starlette 0.49.1)
#
# Testing before upgrade:
# 1. Verify StreamableHTTP works: docker compose exec mcp-api python client_smoke.py
# 2. Check for task group errors in logs
# 3. Run integration tests with actual MCP clients
# =============================================================================
starlette==0.49.1
anyio==4.6.2.post1

# =============================================================================
# Shared Dependencies
# =============================================================================

# HTTP client (Nessus API, MCP client testing)
httpx>=0.27.0

# Redis client
# IMPORTANT: Must match Redis server version (currently 7.4.7)
redis>=7.0.0,<8.0.0

# Configuration
pyyaml>=6.0.1

# Structured logging
structlog>=24.1.0

# Metrics
prometheus-client>=0.20.0
